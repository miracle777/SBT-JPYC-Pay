# 📱 PWA インストール・使用ガイド

このアプリは **PWA (Progressive Web App)** として、パソコン・タブレット・スマートフォンにインストールして使用できます。ユーザー管理なしで各デバイスで独立して利用できます。

---

## 📋 目次

1. [PWAとは](#pwaとは)
2. [インストール方法](#インストール方法)
3. [デバイス別設定](#デバイス別設定)
4. [SBT発行への影響](#sbt発行への影響)
5. [データ管理](#データ管理)
6. [よくある質問](#よくある質問)

---

## PWAとは

**PWA (Progressive Web App)** = ウェブアプリをネイティブアプリのようにインストールして使える技術

### 🎯 特徴

| 特徴 | 説明 |
|------|------|
| **インストール** | アプリストア経由ではなく、ウェブから直接インストール |
| **オフライン動作** | インストール後、インターネット接続なしでも一部機能が使用可能 |
| **ホーム画面** | スマホ・パソコンのホーム画面に追加可能 |
| **独立した環境** | 各デバイスでデータが独立して保存される |
| **自動更新** | 更新は自動的に行われ、次回起動時に反映 |
| **PWAの制限** | ブラウザ内で動作するため、MetaMaskなど一部ブラウザ機能は制限あり |

---

## インストール方法

### 🖥️ **パソコン (Windows/Mac/Linux)**

#### Chrome/Edge の場合
1. ウェブサイトを開く
2. **アドレスバーの右側に「インストール」ボタン**が表示される
   ```
   📲 | 🔒 | ⋯ (インストールボタン)
   ```
3. 「インストール」をクリック
4. ウィンドウが開き、「インストール」を確認
5. **スタートメニュー**または**アプリケーション**フォルダに追加される

#### Firefox の場合
1. ウェブサイトを開く
2. **アドレスバーの左側**のサイトアイコンをクリック
3. 「アプリケーション」→「このサイトをアプリとしてインストール」
4. 確認して完了

#### Safari (Mac) の場合
1. ウェブサイトを開く
2. メニューの **「ファイル」→「ドックに追加」** または **「メニュー」→「ホーム画面に追加」**
3. 名前を確認して「追加」

---

### 📱 **スマートフォン**

#### iOS (iPhone/iPad)
1. Safari でウェブサイトを開く
2. **下部の共有ボタン**（上矢印アイコン）をタップ
3. **「ホーム画面に追加」**をタップ
4. アプリ名を確認して「追加」
5. **ホーム画面にアイコンが追加される**

> **⚠️ 注意**: Safari 標準ブラウザのみ対応。Chrome など他のブラウザはこの機能が使えません。

#### Android (Chrome)
1. Chrome でウェブサイトを開く
2. **右上のメニュー** (⋮) をタップ
3. **「アプリをインストール」** または **「ホーム画面に追加」**をタップ
4. 確認して「インストール」
5. **ホーム画面にアイコンが追加される**

> **💡 Tip**: Chrome メニューに表示されない場合は、ブラウザが最新版か確認してください。

---

### 📱 **タブレット (iPad/Android)**

スマートフォンと同じ方法で、より大きな画面でインストール可能です。

---

## デバイス別設定

### 🖥️ **パソコン (Windows 10/11)**

#### デスクトップアプリとして使用
```
スタートメニュー → "SBT Pay" を検索 → クリックで起動
```

#### タスクバーにピン留め
1. アプリを起動
2. ウィンドウのタイトルバーで右クリック
3. 「タスクバーにピン留めする」

#### 全画面表示
- **F11** キーで全画面表示/通常表示の切り替え
- または ウィンドウ右上の全画面ボタン

---

### 📱 **スマートフォン**

#### ホーム画面整理
- 他のアプリと同じように移動・削除が可能
- フォルダに入れてグループ化できます

#### 通知設定 (オプション)
```
設定 → アプリ通知 → SBT Pay
```

---

## SBT発行への影響

### ✅ **PWAで正常に動作する機能**

| 機能 | 対応状況 | 備考 |
|------|--------|------|
| SBT テンプレート管理 | ✅ 完全動作 | ローカルDB (IndexedDB) に保存 |
| SBT 発行・追跡 | ✅ 完全動作 | オフライン対応 |
| QR コード表示 | ✅ 完全動作 | デバイスで生成 |
| 画像アップロード | ✅ 完全動作 | Base64 でローカル保存 |
| ウォレット接続 | ⚠️ 制限あり | 詳細は下記参照 |

### ⚠️ **PWAで制限される機能**

#### MetaMask 接続 (ウォレット機能)

**パソコン・タブレット:**
- ✅ **MetaMask 拡張機能がインストール済みなら完全動作**
- PWA 版の MetaMask ウォレットアイコンを経由して接続

**スマートフォン:**
- ❌ **通常の Safari/Chrome ではMetaMask が利用できません**
- 代替方法:
  1. **MetaMask モバイルアプリ**のブラウザ機能を使用
  2. WalletConnect 対応ウォレット (Rainbow, Phantom など) を使用
  3. サーバー側でウォレット接続を処理 (別実装が必要)

### 🔄 **推奨デバイス構成**

| デバイス | SBT管理 | QR決済 | ウォレット接続 | 用途例 |
|---------|--------|--------|---------------|--------|
| **PC** | ✅ 最適 | ✅ 可 | ✅ 最適 | 店舗スタッフ用メイン端末 |
| **タブレット** | ✅ 最適 | ✅ 最適 | ✅ 対応* | レジカウンター用 |
| **スマホ** | ⚠️ 可 | ⚠️ 可 | ❌ 別アプリ* | ウォレット接続用 |

> **\*** スマートフォンでウォレット接続が必要な場合は MetaMask アプリのブラウザを使用してください

---

## データ管理

### 💾 **ローカルデータ保存**

**IndexedDB + localStorage**: 
- 各デバイスに完全独立したデータベース
- インターネット接続なしでオフライン動作可能
- 容量: 50MB～数GB (デバイス依存)

```
パソコン A:  SBT テンプレート 100個
   ↓
タブレット B: SBT テンプレート 30個 (独立)
   ↓  
スマホ C:    SBT テンプレート 0個 (初期状態)
```

### 📤 **デバイス間のデータ共有**

1. **エクスポート**
   - パソコン A: 「データをエクスポート」 → JSON ファイル保存

2. **インポート**
   - パソコン B (またはタブレット): 「データをインポート」 → JSON ファイル選択
   - ✅ データがマージされる

3. **クラウド連携** (オプション実装)
   - Google Drive / OneDrive に自動バックアップ
   - デバイス間で同期可能
   - 別途設定が必要

### 🗑️ **データ削除**

**アプリを削除:**
```
パソコン: スタートメニュー → SBT Pay → アンインストール
スマホ:  ホーム画面 → 長押し → 削除
```

> **⚠️ 警告**: アプリ削除時にローカルデータは完全削除されます。
> 重要なデータはエクスポートして保存してください。

---

## よくある質問

### Q1: インターネット接続がない場合は使えない?

**A:** 大部分は使えます。
- ✅ SBT 管理、データ表示：**完全に使用可能** (ローカルDB から読み込み)
- ✅ QR コード生成：**完全に使用可能** (デバイス内処理)
- ❌ ブロックチェーン取引：**インターネット接続が必須**
- ❌ 新しいアプリ更新：**インターネット接続が必須**

### Q2: パソコンとタブレットでデータを同期したい

**A:** 以下の方法があります。

1. **エクスポート/インポート機能** (標準装備)
   - 手動でデータをファイル形式でやり取り
   - シンプルだが手作業が必要

2. **クラウド連携** (別途実装)
   - Firebase, Supabase などを使用
   - 自動同期が可能
   - サーバー運用が必要

3. **ローカルネットワーク同期** (Tauri 版の場合)
   - 同じWiFiネットワーク内で自動同期
   - より詳しくは下記参照

### Q3: MetaMask が接続できない

**症状:**
```
"MetaMask が見つかりません" エラー
```

**解決策:**

| デバイス | 対策 |
|---------|------|
| **パソコン** | Chrome/Edge に MetaMask 拡張機能をインストール |
| **タブレット** | MetaMask モバイルアプリ使用、または拡張機能対応ブラウザ |
| **スマホ** | MetaMask アプリの「ブラウザ」機能を使用してアクセス |

### Q4: アプリが重い・遅い

**原因と対策:**

| 原因 | 対策 |
|------|------|
| キャッシュが溜まった | 設定 → キャッシュクリア → アプリ再起動 |
| 大量のデータ | 古いデータを削除、またはエクスポート後リセット |
| ブラウザが古い | Chrome/Safari/Edge を最新版に更新 |

### Q5: アプリが自動更新される?

**A:** はい。

```
新しいバージョンが利用可能
   ↓
バックグラウンドで自動ダウンロード
   ↓
次回起動時に反映
```

アップデート通知はブラウザコンソールに表示されます。

### Q6: 複数ユーザーで同じ端末を共有したい

**A:** **PWA では不可能です** (ブラウザデータが共有されるため)。

**代替案:**

1. **デバイスを分ける**
   - 店舗スタッフごとにパソコン/タブレットを用意

2. **ユーザー分離** (サーバー実装)
   - ログイン機能を追加
   - バックエンドデータベースでユーザー管理
   - PWA + サーバー構成が必要

3. **Tauri デスクトップ版** (将来実装)
   - マルチユーザー対応が容易

---

## 🚀 パフォーマンス最適化

### キャッシュ戦略

```
アイコン・画像
   ↓ (CacheFirst)
30日キャッシュ
   ↓
古い画像を削除
   ↓
新しいアイコンをダウンロード
```

### Service Worker の更新

```
1時間ごとにチェック
   ↓
新しいバージョンがあれば
   ↓
バックグラウンドでダウンロード
   ↓
次回起動時に自動反映
```

---

## 📞 トラブルシューティング

### アプリが起動しない

```bash
# ブラウザコンソール (F12) で確認
1. ネットワークエラーをチェック
2. Service Worker のステータスを確認
3. ブラウザキャッシュをクリア
   → 設定 → キャッシュとクッキーをクリア
4. アプリを再インストール
```

### データが保存されない

```bash
1. ローカルストレージが有効か確認
   # ブラウザ設定で「ローカルストレージを許可」
2. 容量が満杯でないか確認 (設定 → ストレージ)
3. IndexedDB が有効か確認 (DevTools → Application)
```

---

## 📚 参考リソース

- [MDN: Progressive Web Apps](https://developer.mozilla.org/ja/docs/Web/Progressive_web_apps)
- [Google: PWA チェックリスト](https://web.dev/pwa-checklist/)
- [MetaMask ドキュメント](https://docs.metamask.io/)
- [IndexedDB API](https://developer.mozilla.org/ja/docs/Web/API/IndexedDB_API)

---

## 💡 将来の機能拡張案

### 実装可能な機能

1. **デスクトップ版 (Tauri)**
   - マルチユーザー対応
   - ローカルネットワーク同期
   - より高度な権限管理

2. **ユーザー認証**
   - ログイン機能
   - 複数ユーザーサポート
   - 店舗ごとのアカウント管理

3. **クラウド同期**
   - Firebase / Supabase 統合
   - 自動バックアップ
   - マルチデバイス同期

4. **オフラインファースト**
   - より詳細なオフラインモード表示
   - ネットワーク復帰時の自動同期
   - ローカル変更の競合解決

---

**最終更新**: 2025年11月14日
**バージョン**: 1.0.0 PWA対応版
